<!DOCTYPE html>
<html>
<head>
    <title>Telegram WebApp</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        pre { background: #f0f0f0; padding: 10px; border-radius: 5px; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>Telegram WebApp Demo</h1>
    <div id="debug"></div>

    <script>
        const tg = window.Telegram.WebApp;
        const debugEl = document.getElementById('debug');
        
        // Инициализация WebApp
        tg.expand();
        tg.ready();

        function sendToServer() {
            if (!tg.initData) {
                debugEl.innerHTML = '<p class="error">No initData available</p>';
                return;
            }

            // Вариант 1: через заголовки
            fetch('https://rat-zealand-governance-desired.trycloudflare.com:8000/webapp', {
                method: 'GET',
                headers: {
                    'X-Telegram-Init-Data': tg.initData
                }
            })
            .then(response => {
                if (!response.ok) throw new Error(`HTTP error ${response.status}`);
                return response.json();
            })
            .then(data => {
                debugEl.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
            })
            .catch(error => {
                debugEl.innerHTML = `<p class="error">Error: ${error.message}</p>`;
                console.error('Request failed:', error);
            });

            // Вариант 2: через query параметр (альтернатива)
            // fetch(`https://rat-zealand-governance-desired.trycloudflare.com:8000/webapp?initData=${encodeURIComponent(tg.initData)}`)
        }

        // Показываем данные пользователя
        if (tg.initDataUnsafe?.user) {
            debugEl.innerHTML = `
                <h2>User Info</h2>
                <pre>${JSON.stringify(tg.initDataUnsafe.user, null, 2)}</pre>
                <button onclick="sendToServer()">Send to Server</button>
            `;
        } else {
            debugEl.innerHTML = '<p class="error">WebApp not initialized</p>';
        }
    </script>
</body>
</html>
